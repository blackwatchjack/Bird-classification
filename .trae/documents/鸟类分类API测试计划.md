# 鸟类分类API测试计划

## 1. 测试目标

* 验证后端API的功能正确性

* 确保各个组件之间的正确交互

* 测试系统在各种情况下的稳定性

* 验证系统性能和响应时间

## 2. 测试范围

### 2.1 核心组件测试

* DataRegistry（数据注册中心）

* IOCDataLoader（数据加载器）

* FileScanner（文件扫描器）

* DataConverter（数据转换器）

### 2.2 API端点测试

* POST /api/scan - 启动扫描任务

* GET /api/status - 获取扫描状态

* GET /api/tree - 获取分类树结构

* GET /api/image-proxy - 图片代理服务

## 3. 测试类型

### 3.1 单元测试

* **数据注册中心测试**：

  * 测试add\_species方法

  * 测试match\_file方法

  * 测试add\_photo方法

  * 测试\_update\_tree方法

* **数据加载器测试**：

  * 测试Excel文件加载

  * 测试数据解析和转换

  * 测试异常处理（文件不存在、格式错误等）

* **文件扫描器测试**：

  * 测试单目录扫描

  * 测试递归扫描

  * 测试文件匹配逻辑

  * 测试支持的文件格式识别

* **数据转换器测试**：

  * 测试分类树转换为el-tree格式

### 3.2 集成测试

* 测试数据加载器与数据注册中心的集成

* 测试文件扫描器与数据注册中心的集成

* 测试整个扫描流程的端到端集成

### 3.3 API测试

* **POST /api/scan**：

  * 测试正常扫描请求

  * 测试多个路径扫描

  * 测试不存在路径处理

  * 测试扫描状态更新

* **GET /api/status**：

  * 测试空闲状态返回

  * 测试扫描中状态返回

  * 测试扫描完成状态返回

* **GET /api/tree**：

  * 测试空树返回

  * 测试有数据时的树结构

  * 测试树结构格式正确性

* **GET /api/image-proxy**：

  * 测试正常图片请求

  * 测试不存在图片处理

  * 测试非图片文件处理

### 3.4 边界测试

* 测试大量文件扫描（性能边界）

* 测试空文件名处理

* 测试超长路径处理

* 测试特殊字符文件名处理

* 测试并发扫描请求

### 3.5 性能测试

* 测试扫描1000+文件的响应时间

* 测试分类树生成的性能

* 测试API响应时间

## 4. 测试环境

* Python 3.8+

* FastAPI 0.104.1

* pytest测试框架

* 测试数据：包含各种鸟类照片的测试目录

## 5. 测试工具

* **pytest**：用于单元测试和集成测试

* **requests**：用于API测试

* **pytest-cov**：用于代码覆盖率分析

* **locust**：用于性能测试

## 6. 测试用例设计

### 6.1 单元测试用例

| 测试对象          | 测试方法               | 预期结果            |
| ------------- | ------------------ | --------------- |
| DataRegistry  | add\_species       | 物种成功添加到注册表      |
| DataRegistry  | match\_file        | 正确匹配文件名到物种ID    |
| DataRegistry  | add\_photo         | 照片成功添加并更新分类树    |
| IOCDataLoader | load\_to\_registry | Excel数据成功加载到注册表 |
| FileScanner   | scan\_directory    | 目录下所有图片文件被正确扫描  |
| FileScanner   | \_process\_file    | 文件被正确匹配和注册      |

### 6.2 API测试用例

| API端点                | 测试场景   | 预期结果           |
| -------------------- | ------ | -------------- |
| POST /api/scan       | 正常扫描请求 | 返回202状态码，扫描开始  |
| POST /api/scan       | 多个路径扫描 | 所有路径被扫描，状态正确更新 |
| GET /api/status      | 扫描中状态  | 返回扫描中状态和进度     |
| GET /api/tree        | 有数据时   | 返回正确的分类树结构     |
| GET /api/image-proxy | 存在的图片  | 返回图片文件         |
| GET /api/image-proxy | 不存在的图片 | 返回错误信息         |

## 7. 测试执行计划

### 7.1 准备工作

* 安装测试依赖（pytest, requests, pytest-cov等）

* 准备测试数据（包含各种鸟类照片的测试目录）

* 准备测试配置

### 7.2 执行顺序

1. 单元测试（确保各个组件功能正确）
2. 集成测试（确保组件之间正确交互）
3. API测试（确保API端点功能正确）
4. 边界测试（测试异常情况）
5. 性能测试（测试系统性能）

### 7.3 测试报告

* 生成测试覆盖率报告

* 生成API测试报告

* 生成性能测试报告

## 8. 测试通过标准

* 单元测试通过率达到100%

* 集成测试通过率达到100%

* API测试通过率达到100%

* 边界测试中所有异常情况被正确处理

* 性能测试中系统响应时间满足要求

## 9. 后续维护

* 每次代码更新后运行测试套件

* 根据新功能添加相应的测试用例

* 定期进行回归测试

## 10. 测试代码结构

```
src/
├── tests/
│
```

